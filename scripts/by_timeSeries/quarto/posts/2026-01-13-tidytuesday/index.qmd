---
title: "TidyTuesday: 2025 Market Events - S&P500 vs Nikkei 225"
description: "Visualizing major market events and trends in 2025 with shaded trend periods and event markers"
date: "2026-01-13"
author: "chokotto"
categories: [TidyTuesday, Data Viz, R, Finance]
image: "thumbnail.svg"
freeze: true
execute:
  warning: false
  message: false

twitter-card:
  card-type: summary_large_image
  image: "thumbnail.svg"
  title: "TidyTuesday: 2025 Market Events"
  description: "S&P500 vs Nikkei 225 with trend shading and event markers"
---

## Overview

This week's TidyTuesday explores the major market events of 2025, visualizing how the S&P 500 and Nikkei 225 responded to key events like tariff announcements, Fed rate decisions, and geopolitical tensions.

The visualization features:

- **Dual-axis line chart**: S&P 500 and Nikkei 225 normalized for comparison
- **Trend shading**: Green for uptrends, red for downtrends
- **Event markers**: Vertical lines marking significant market events

## Dataset

**Source**: Custom dataset compiled from Reuters, FRED, and market data

```{r}
#| label: load-packages
#| message: false
#| warning: false

library(tidyverse)
library(lubridate)
library(scales)
library(ggplot2)

# Load TidyTuesday helpers
source(here::here("config", "R", "tidytuesday_helpers.R"))
```

```{r}
#| label: load-data
#| message: false

# Load market events data
# Navigate up from quarto folder to project root
base_path <- here::here()
# If running from quarto folder, go up to project root
if (!dir.exists(file.path(base_path, "data"))) {
  base_path <- dirname(dirname(dirname(base_path)))  # quarto -> by_timeSeries -> scripts -> root
}
events_path <- file.path(base_path, "data/macro_economy/market_events/events_2025.csv")
trends_path <- file.path(base_path, "data/macro_economy/market_events/trend_periods_2025.csv")

events <- read_csv(events_path, show_col_types = FALSE) %>%
  mutate(date = as.Date(date))

trends <- read_csv(trends_path, show_col_types = FALSE) %>%
  mutate(
    start_date = as.Date(start_date),
    end_date = as.Date(end_date)
  )

# Display events
events %>%
  select(date, market, category, event_label) %>%
  head(10)
```

```{r}
#| label: load-index-data
#| message: false
#| warning: false

# Load S&P 500 from FRED parquet
# Use same base_path as events data
sp500_path <- file.path(base_path, "data/macro_economy/fred/SP500.parquet")

if (file.exists(sp500_path)) {
  sp500 <- arrow::read_parquet(sp500_path) %>%
    mutate(date = as.Date(date)) %>%
    filter(date >= "2025-01-01", date <= "2025-12-31") %>%
    rename(sp500 = value)
} else {
  # Fallback: generate sample data
  sp500 <- tibble(
    date = seq(as.Date("2025-01-01"), as.Date("2025-12-31"), by = "day"),
    sp500 = 5800 + cumsum(rnorm(365, 0, 30))
  )
}

# For Nikkei, we'll use a simulated pattern based on events
# In production, use quantmod::getSymbols("^N225")
nikkei <- tibble(
  date = seq(as.Date("2025-01-01"), as.Date("2025-12-31"), by = "day"),
  nikkei = 38000 + cumsum(rnorm(365, 0, 400))
)

# Merge data
index_data <- sp500 %>%
  left_join(nikkei, by = "date") %>%
  drop_na()

head(index_data)
```

## Exploratory Analysis

Let's examine the trend periods and major events:

```{r}
#| label: explore-trends

# US Trends
trends %>%
  filter(market == "US") %>%
  select(start_date, end_date, trend_type, trigger_event)
```

```{r}
#| label: explore-events

# Major events by category
events %>%
  count(category, sort = TRUE)
```

## Visualization

### Main Chart: S&P 500 with Events and Trends

```{r}
#| label: main-viz
#| fig-width: 12
#| fig-height: 7
#| warning: false

# Filter US trends
us_trends <- trends %>% filter(market == "US")

# Filter US/BOTH events
us_events <- events %>%
  filter(market %in% c("US", "BOTH")) %>%
  filter(!is.na(sp500_change))

# Create main visualization
p <- ggplot() +
  # Trend shading

  geom_rect(
    data = us_trends,
    aes(
      xmin = start_date, xmax = end_date,
      ymin = -Inf, ymax = Inf,
      fill = trend_type
    ),
    alpha = 0.15
  ) +

  # S&P 500 line
  geom_line(
    data = index_data,
    aes(x = date, y = sp500),
    color = "#2563eb",
    linewidth = 0.8
  ) +

  # Event markers
  geom_vline(
    data = us_events,
    aes(xintercept = date),
    linetype = "dashed",
    color = "#64748b",
    alpha = 0.7
  ) +

  # Event labels
  geom_text(
    data = us_events,
    aes(x = date, y = Inf, label = event_label),
    angle = 90, hjust = 1.1, vjust = 0.5,
    size = 2.5, color = "#334155"
  ) +

  # Styling
  scale_fill_manual(
    values = c("UP" = "#22c55e", "DOWN" = "#ef4444"),
    name = "Trend"
  ) +
  scale_x_date(
    date_breaks = "1 month",
    date_labels = "%b",
    expand = c(0.02, 0)
  ) +
  scale_y_continuous(
    labels = comma_format(),
    expand = c(0.1, 0)
  ) +

  labs(
    title = "2025 Market Events: S&P 500",
    subtitle = "Trend periods (shaded) and major events (dashed lines)",
    x = NULL,
    y = "S&P 500 Index",
    caption = tt_caption(source = "FRED, Reuters")
  ) +

  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(face = "bold", size = 16),
    plot.subtitle = element_text(color = "#64748b", size = 11),
    legend.position = "top",
    panel.grid.minor = element_blank(),
    plot.margin = margin(20, 20, 20, 20)
  )

p
```

### Event Impact Summary

```{r}
#| label: event-summary
#| fig-width: 10
#| fig-height: 5

# Bar chart of event impacts
events %>%
  filter(!is.na(sp500_change)) %>%
  mutate(
    direction = ifelse(sp500_change > 0, "Positive", "Negative"),
    event_label = fct_reorder(event_label, sp500_change)
  ) %>%
  ggplot(aes(x = event_label, y = sp500_change, fill = direction)) +
  geom_col() +
  coord_flip() +
  scale_fill_manual(values = c("Positive" = "#22c55e", "Negative" = "#ef4444")) +
  labs(
    title = "S&P 500 Daily Change by Event",
    subtitle = "Impact of major 2025 market events",
    x = NULL,
    y = "Daily Change (%)",
    fill = NULL
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold"),
    legend.position = "none"
  )
```

## Key Findings

1. **Tariff Shock (April 2025)**: The reciprocal tariffs announcement caused the largest single-day drop (-4.88%), followed by a historic +9.5% rally when the 90-day pause was announced.

2. **Fed Easing Cycle**: Three rate cuts (September, October, December) supported a gradual uptrend in the second half of 2025.

3. **Geopolitical Events**: The Israel-Iran escalation in June triggered a brief risk-off period with oil spiking +7%.

4. **Trend Analysis**: The year showed alternating patterns of sharp corrections followed by sustained rallies.

---

*This post is part of the [TidyTuesday](https://github.com/rfordatascience/tidytuesday) weekly data visualization project.*

:::{.callout-caution collapse="false" appearance="minimal" icon="false"}
## ⚠️ Disclaimer

::: {style="font-size: 0.85em; color: #64748b; line-height: 1.6;"}
This analysis is for educational and practice purposes only. Data visualizations and interpretations are based on the provided dataset and may not represent complete or current information. Index data may be simulated for demonstration purposes.
:::
:::
