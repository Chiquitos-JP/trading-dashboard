---
description: 週次定期作業（Weekly Review / MakeoverMonday / TidyTuesday）の手順と前提
alwaysApply: true
---

# 週次ルーティンワーク

## 1. Weekly Review（投資レビュー）

- ローカルで `run_all.py` + AI 分析により生成
- 投稿は **手動**（自動投稿なし）
- テンプレート: `scripts/by_timeSeries/quarto/posts/_template_weekly_review.qmd`

## 2. MakeoverMonday（Python / Plotly）

- ローカルで `index.qmd` + `thumbnail.svg` を作成
- GitHub Actions でレンダリング＆自動投稿
- テンプレート: `posts/_template_makeover_monday.qmd`

## 3. TidyTuesday（R / ggplot2）

- ローカルで `index.qmd` + `thumbnail.svg` + `prepare_data.py` を作成
- **ローカルレンダリング不可**（Windows ARM64 + Quarto の互換性制約）
- GitHub Actions（R knitr）でレンダリング → 自動投稿
- テンプレート: `posts/_template_tidytuesday.qmd`

## CI 操作コマンド（gh CLI）

```bash
# ワークフロー実行（post_type: all / tidytuesday / makeover-monday）
gh workflow run "render-posts.yml" -f post_type=tidytuesday -f post_date=2026-02-11 --repo Chiquitos-JP/trading-dashboard

# 実行状況確認
gh run list --workflow=render-posts.yml --limit 3 --repo Chiquitos-JP/trading-dashboard

# ログ確認
gh run view <run_id> --log --repo Chiquitos-JP/trading-dashboard
```

## 投稿フォルダ命名規則

- `posts/YYYY-MM-DD-makeover-monday/`
- `posts/YYYY-MM-DD-tidytuesday/`
- `posts/YYYY-MM-DD-weekly-review/`

## 出力先

- Quarto 出力: `docs/quarto/latest/`（`_quarto.yml` の `output-dir`）
- CI がレンダリング結果を `docs/` に commit & push する

## コマンド判断基準

| ユーザーの指示 | データ状態 | 実行スクリプト |
|---|---|---|
| 「生データ格納済み」 | raw CSV のみ | `py scripts/by_timeSeries/runners/run_all.py`（フルパイプライン） |
| 「可視化まで完了」 | outputs/ にチャート生成済み | `py scripts/by_timeSeries/runners/run_weekly_review.py`（レビュー+レンダリングのみ） |
| 「レンダリングだけ」 | index.qmd 作成済み | `py scripts/by_timeSeries/runners/run_all.py --render-only` |
| 「強制再実行」 | 任意 | `py scripts/by_timeSeries/runners/run_all.py --force` |

判断に迷う場合はユーザーに確認せず `run_all.py` を実行する（チェックポイント機能により処理済みステップは自動スキップされる）。

## 前提条件（実行前に確認）

1. `data/trading_account/realized_pl/raw/` に最新 CSV が配置されていること
2. `.env` に `OPENAI_API_KEY` が設定されていること（なくてもフォールバック動作する）
3. インターネット接続（FRED 為替データ取得に必要）

## よくあるエラーと対処

| エラー | 原因 | 対処 |
|---|---|---|
| exit code 9009 | `python` コマンドが見つからない | `py` を使用 |
| WinError 32 | Dropbox がファイルロック中 | 無視可（バックアップ失敗のみ、本体に影響なし） |
| NaTType エラー | マクロデータの欠損 | 無視可（該当チャートのみスキップ） |
| タイムアウト | block_until_ms が短い | 600000（10分）に設定して再実行 |

## 完了後の確認

1. exit code: 0 を確認
2. `scripts/by_timeSeries/quarto/posts/YYYY-MM-DD-weekly-review/index.qmd` の存在確認
3. `docs/quarto/latest/posts/YYYY-MM-DD-weekly-review/index.html` の存在確認
4. 投稿は手動（AI は投稿しない）
