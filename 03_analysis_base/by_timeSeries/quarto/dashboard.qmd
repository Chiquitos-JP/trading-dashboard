---
title: "Dashboard"
page-layout: full
---

```{python}
#| echo: false
#| warning: false
#| message: false
from pathlib import Path
import shutil, os

def find_project_root(start: Path) -> Path:
    for p in [start] + list(start.parents):
        if (p / "requirements.txt").exists() or (p / "stockTrading.Rproj").exists():
            return p
    return start

proj_dir = Path(os.getcwd())
root = find_project_root(proj_dir)
fig_root = root / "04_output" / "figures"

src_html = None
if fig_root.exists():
    for d in sorted(fig_root.glob("realizedPl_*"), reverse=True):
        cand = sorted(d.glob("kpi_ytd_monthly_*.html"), reverse=True)
        if cand:
            src_html = cand[0]
            break

output_base = os.environ.get("QUARTO_PROJECT_OUTPUT_DIR", str(proj_dir))
kpi_dir = Path(output_base) / "kpi"
kpi_dir.mkdir(parents=True, exist_ok=True)

if src_html and src_html.exists():
    shutil.copy2(src_html, kpi_dir / "index.html")
```

<div class="callout-note">
<p>今後年度が替わる度に記録が更新できる構造にする事が課題。</p>
</div>

<iframe src="kpi/index.html" width="100%" height="1600" style="border:none;"></iframe>
